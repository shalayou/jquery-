<!DOCTYPE html>
<html lang="en">
<head>
    <title>多表头</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <link href="./demo/demo.css" rel="stylesheet" type="text/css" />

    <script src="./scripts/boot.js" type="text/javascript"></script>
    <!-- <script src="./demo/datagrid/js/ColumnsMenu.js" type="text/javascript"></script> -->
    <style>
         .mini-grid-headerCell{background:#efefef !important;padding: 4px 0;border-left:transparent !important;border-right:1px solid #e6e6e6!important;border-top:transparent;border-bottom:transparent;}
        .mini-grid-cell{border-left:transparent !important;border-right:1px solid #e6e6e6!important;}
        .mini-grid-topRightCell{background:#efefef !important;border-bottom:transparent;}
        .mini-grid-border{border:1px solid #d7ebf9 !important;border-top:none !important;}
        .mini-grid-row {background:#fff !important;}
        .mini-grid-row-selected{color:blue !important;background:#f7f7f7 !important;}
        .mini-pager{background:#fff !important;}
        #datagrid1 table tr td{height:43px;line-height: 34px;}
        #datagrid1 table tr:nth-child(1) td{height:0 !important;line-height: 28px;}
        #datagrid1 table tr:nth-child(2) td{height:0 !important;line-height: 28px;}
    </style>
</head>
<body style="background: #f5f5f5;">
     <!-- url="https://shalayou.github.io/jquery-/miniuiSub/WebContent/demo/data/data1.json?method=SearchEmployees"  --> 

 <div id="datagrid1" class="mini-datagrid" style="width:700px;height:280px;" 
       
        url="./demo/data/data1.json?method=SearchEmployees" 
        idField="id">
        <div property="columns">
            <div type="indexcolumn"></div>                
            <div field="loginname" width="120" headerAlign="center" allowSort="true">员工帐号</div>    
            <div field="name" width="120" headerAlign="center" allowSort="true">姓名</div>    
            <div header="工作信息" headerAlign="center">
                <div property="columns">
                    <div width="120" headerAlign="center">部门&职务
                        <div property="columns">
                            <div field="dept_name" width="120">所属部门</div>
                            <div field="position_name" width="100">职位</div>
                        </div>
                    </div>
                    <div field="salary" width="100" allowSort="true">薪资</div>
                </div>
            </div>
            <div field="createtime" width="100" headerAlign="center" dateFormat="yyyy-MM-dd" allowSort="true">创建日期</div>    
            <div header="基本信息">
                <div property="columns">
                    <div field="gender" width="100" renderer="onGenderRenderer">性别</div>
                    <div field="age" width="100" allowSort="true">年龄</div>
                    <div field="birthday" width="100" renderer="onBirthdayRenderer">出生日期</div>
                    <div field="married" width="100" align="center" renderer="onMarriedRenderer">婚否</div>
                    <div field="email" width="100">邮箱</div>
                </div>
            </div>
            <div header="学历信息">
                <div property="columns">
                    <div field="educational_name" width="100">学历</div>
                    <div field="school" width="120">毕业院校</div>
                </div>
            </div>                     
        </div>
    </div>
    <script type="text/javascript">

    	var H = parseInt($(window).height())-96;
    	$("#datagrid1").css("height",H+"px");
          //初始化操作列按钮
		function draw(e) {
    		var record = e.record;
   	 		var column = e.column;
    		if (column.name == "Operate") {
        		// e.cellHtml = '<a class="mini-button" href="javascript:edit(0)" ><span class="mini-button-text  mini-button-icon icon-edit" style="" >   查看   </span></a><a class="mini-button" href="javascript:edit(1)"><span class="mini-button-text  mini-button-icon icon-edit" style="">   编辑   </span></a>'
        		e.cellHtml = '<a id="search" class="mini-button" iconCls="icon-reload" onclick="searchCheckList()">查看检修单</a><a id="Relation" class="mini-button" iconCls="icon-reload" onclick="relateCheckList()">关联检修单</a>'
    		}
		}

        mini.parse();
        
        var grid = mini.get("datagrid1");
        var editForm = document.getElementById("editForm1");
        var form = new mini.Form("editForm1");
        grid.hideColumn("Operate");
        grid.load();

       // var menu = new ColumnsMenu(grid);
        
        function search() {
            var key = document.getElementById("key").value;
            grid.load({ key: key});
        }
        $("#key").bind("keydown", function (e) {
            if (e.keyCode == 13) {
                search();
            }
        });

        function onSelectionChanged(e) {
            
            var grid = e.sender;
            var record = grid.getSelected();
             /*var uid = record.id;
             var loginname = record.loginname;
             if(loginname=="就看看看"){
                alert(loginname);
             }else{
                alert(uid);
            }*/
            if(record){
                editRow(record._uid);
            }else {                
                form.reset();
            }
        }
          console.log(grid.getRowByUID("6"));
         function editRow(row_uid){
            var row = grid.getRowByUID(row_uid);
          
            if (row) {
               

                //表单加载员工信息
                var form = new mini.Form("editForm1");
                if (grid.isNewRow(row)) {                    
                    form.reset();
                } else {
                    form.loading();
                    $.ajax({
                        url: "https://shalayou.github.io/jquery-/miniuiSub/WebContent/demo/data/AjaxService.json?method=GetEmployee&id=" + row.id,
                        success: function (text) {
                            var o = mini.decode(text);
                            form.setData(o);
                            form.unmask();
                        }
                    });
                }

                grid.doLayout();
            }
        }
        ///////////////////////////////////////////////////////
        var Genders = [{ id: 1, text: '男' }, { id: 2, text: '女'}];
        function onGenderRenderer(e) {
            for (var i = 0, l = Genders.length; i < l; i++) {
                var g = Genders[i];
                if (g.id == e.value) return g.text;
            }
            return "";
        }
        function datagrid1_onmouseup(e) {//实现简单的联动
             var record=e.record;
          console.log(record);
        }

    </script>
</body>
</html>